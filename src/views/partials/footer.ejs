<link rel="stylesheet" type="text/css" href="/css/chatbot.css">


<footer class="footer">
    <div class="container">
        <div class="footer-row">
            <div class="footer-column">
                <h5>Our journey</h5>
                <p>From humble beginnings, we have built a community of loyal customers...</p>
            </div>
            <div class="footer-column">
                <h5>Support</h5>
                <p>141 Xuan Thuy, Dich Vong Hau, Cau Giay, Ha Noi</p>
                <p>group11@gmail.com</p>
                <p>+843949505816</p>
            </div>
            <div class="footer-column">
                <h5>Follow us</h5>
                <div class="social-icons">
                    <a href="#" class="social-icon twitter">
                        <i class="icon-twitter">ùïè</i>
                    </a>
                    <a href="https://www.instagram.com/thah.lam7/" target="_blank" class="social-icon instagram">
                        <i class="icon-instagram">üì∏</i>
                    </a>
                    <a href="https://www.facebook.com/thanhlamk4/" target="_blank" class="social-icon facebook">
                        <i class="icon-facebook">∆í</i>
                    </a>
                </div>
            </div>
        </div>
        <hr class="footer-divider">
        <p class="copyright">¬© Copyright Group11 2025. All rights reserved</p>
    </div>
    
    <div class="toast-container">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-content">
                <div class="toast-body" id="toastMessage">
                    <!-- Message will display here -->
                </div>
                <button type="button" class="toast-close" data-dismiss="toast" aria-label="Close">√ó</button>
            </div>
        </div>
    </div>
    
    <!-- Chatbot Button -->
    <div id="chatbot-button" onclick="toggleChat()">
        üí¨ Chat
    </div>

    <!-- Chatbot Window -->
    <div id="chatbot-container">
        <div id="chatbot-header">
            <span>Chatbot</span>
            <button onclick="toggleChat()">√ó</button>
        </div>
        <div id="chatbot-messages"></div>
        <textarea id="chatbot-input" placeholder="Type a message..." onkeypress="sendMessage(event)"></textarea>
    </div>
</footer>

<script>
    function toggleChat() {
        let chatbot = document.getElementById("chatbot-container");
        chatbot.style.display = chatbot.style.display === "none" || chatbot.style.display === "" ? "block" : "none";
    }

    async function sendMessage(event) {
        if (event.key === "Enter") {
            let input = document.getElementById("chatbot-input");
            let message = input.value.trim();
            if (message === "") return;

            let chatbox = document.getElementById("chatbot-messages");

            let userMessage = document.createElement('div');
            userMessage.className = "chat-message user";
            userMessage.innerHTML = `<div class="chat-bubble">${message}</div>`;
            chatbox.appendChild(userMessage);
            
            saveChatHistory();
            input.value = "";
            chatbox.scrollTop = chatbox.scrollHeight;

            try {
                let response = await fetch(`http://localhost:8000/api/chatbot?message=${encodeURIComponent(message)}`);
                let data = await response.json();

                // Add bot message to chat interface
                let botMessage = document.createElement('div');
                botMessage.className = "chat-message bot";
                botMessage.innerHTML = `<div class="chat-bubble">${data.response.replace(/\n/g, "<br>")}</div>`;
                chatbox.appendChild(botMessage);
                
                saveChatHistory();
                chatbox.scrollTop = chatbox.scrollHeight;
            } catch (error) {
                console.error("Chatbot API error:", error);
                let errorMessage = document.createElement('div');
                errorMessage.className = "chat-message bot";
                errorMessage.innerHTML = `<div class="chat-bubble">Sorry! I can't answer now.</div>`;
                chatbox.appendChild(errorMessage);
                chatbox.scrollTop = chatbox.scrollHeight;
            }
        }
    }

    function saveChatHistory() {
        let chatbox = document.getElementById("chatbot-messages");
        sessionStorage.setItem("chatHistory", chatbox.innerHTML);
    }

    function loadChatHistory() {
        let chatbox = document.getElementById("chatbot-messages");
        let history = sessionStorage.getItem("chatHistory");

        if (history) {
            chatbox.innerHTML = history;
        } else {
            let welcomeMessage = document.createElement('div');
            welcomeMessage.className = "chat-message bot";
            welcomeMessage.innerHTML = `<div class="chat-bubble">Hello! How can I assist you today?</div>`;
            chatbox.appendChild(welcomeMessage);
            
            // Option buttons
            let optionsContainer = document.createElement('div');
            optionsContainer.className = "chat-options";
            optionsContainer.innerHTML = `
                <button onclick="selectOption('info')">üìå Website Information</button>
                <button onclick="selectOption('usage')">üìñ How to Use the Website</button>
                <button onclick="selectOption('advice')">üõí Product Consultation</button>
                <button onclick="selectOption('others')">‚ùì Other Questions</button>
            `;
            chatbox.appendChild(optionsContainer);
        }
    }

    function selectOption(option) {
        let chatbox = document.getElementById("chatbot-messages");
        let response = "";

        switch (option) {
            case 'info':
                response = "Tk88 - UET Store is an e-commerce platform specializing in smart electronic products. It is also a marketplace where you can buy or sell various items.";
                break;
            case 'usage':
                response = "Which part of the website would you like me to guide you through?";
                break;
            case 'advice':
                response = "What product would you like me to recommend?";
                break;
            case 'others':
                response = "You can ask me anything related to the website!";
                break;
        }

        let botResponse = document.createElement('div');
        botResponse.className = "chat-message bot";
        botResponse.innerHTML = `<div class="chat-bubble">${response}</div>`;
        chatbox.appendChild(botResponse);
        
        saveChatHistory();
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    document.addEventListener("DOMContentLoaded", loadChatHistory);
</script>

